# TQServer Configuration

# Server settings
server:
  # Port for the main HTTP server to listen on
  port: 8080

  # Timeouts for HTTP server
  read_timeout_seconds: 30
  write_timeout_seconds: 30
  idle_timeout_seconds: 120

  # Server log file
  # Placeholders: {date} = YYYY-MM-DD date
  # Use null, empty string, or ~ to disable file logging (only log to stdout/stderr)
  log_file: "logs/server_{date}.log"

# Worker settings
workers:
  # Directory for compiled worker binaries
  bin_dir: "bin"

  # Port range for worker processes
  port_range_start: 9000
  port_range_end: 9999

  # Worker startup settings
  startup_delay_ms: 100 # Time to wait for worker to start

  # Graceful restart settings
  restart_delay_ms: 100 # Delay before stopping old worker
  shutdown_grace_period_ms: 500 # Time to wait for graceful shutdown

  # Default per-worker configuration (applies to all workers unless overridden)
  default:
    go_max_procs: 2 # Sets Go's GOMAXPROCS (CPU threads, 0 = NumCPU)
    max_requests: 0 # Restart worker after N requests (0 = unlimited)
    read_timeout_seconds: 30 # HTTP read timeout for workers
    write_timeout_seconds: 30 # HTTP write timeout for workers
    idle_timeout_seconds: 120 # HTTP idle timeout for workers
    go_mem_limit: "" # Go's GOMEMLIMIT (e.g., "512MiB", "2GiB", empty = unlimited)
    log_file: "logs/{path}/worker_{date}.log" # Log file path template (null/empty/~ = no file logging)

# Per-path worker configuration overrides (optional)
# paths:
#   "/api":
#     go_max_procs: 2
#     max_requests: 5000
#     read_timeout_seconds: 15
#     write_timeout_seconds: 15
#     idle_timeout_seconds: 60
#     go_mem_limit: "256MiB"

# File watching settings
file_watcher:
  # Debounce delay to avoid multiple rebuilds for rapid file changes
  debounce_ms: 50

# Pages directory
pages:
  directory: "pages"
