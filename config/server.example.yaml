# Example: Custom TQServer Configuration
# This file demonstrates all available configuration options

# Server settings
server:
  # Port for the main HTTP server to listen on
  port: 3000 # Default: 8080

  # Timeouts for HTTP server (in seconds)
  read_timeout_seconds: 60 # Default: 30 - Time allowed to read request
  write_timeout_seconds: 60 # Default: 30 - Time allowed to write response
  idle_timeout_seconds: 180 # Default: 120 - Keep-alive timeout

  # Server log file path
  # Placeholders: {date} = YYYY-MM-DD date
  # Use null, empty string, or ~ to disable file logging (only log to stdout/stderr)
  log_file: "logs/tqserver_{date}.log" # Default: logs/tqserver_{date}.log

# Worker settings
workers:
  # Directory for temporary worker binaries
  # Can be absolute path or relative to project root
  temp_dir: "bin" # Default: bin

  # Port range for worker processes
  # Workers are assigned ports sequentially from this range
  # Make sure the range is large enough for all your pages
  port_range_start: 10000 # Default: 9000
  port_range_end: 19999 # Default: 9999

  # Worker startup settings (in milliseconds)
  startup_delay_ms: 200 # Default: 100 - Time to wait for worker to start before routing traffic

  # Graceful restart settings (in milliseconds)
  restart_delay_ms: 200 # Default: 100 - Delay before stopping old worker
  shutdown_grace_period_ms: 1000 # Default: 500 - Time to wait for graceful shutdown

  # Default per-worker configuration (applies to all workers unless overridden)
  default:
    go_max_procs: 2 # Default: 1 - Sets Go's GOMAXPROCS (CPU threads, 0 = NumCPU)
    max_requests: 10000 # Default: 0 (unlimited) - Restart worker after N requests
    read_timeout_seconds: 60 # Default: 30 - HTTP read timeout for workers
    write_timeout_seconds: 60 # Default: 30 - HTTP write timeout for workers
    idle_timeout_seconds: 180 # Default: 120 - Idle timeout for workers
    go_mem_limit: "512MiB" # Default: "" (unlimited) - Go's GOMEMLIMIT (e.g., "512MiB", "2GiB")
    # Placeholders: {path} = worker path (e.g., api/users), {date} = YYYY-MM-DD date
    # Use null, empty string, or ~ to disable file logging (only log to stdout/stderr)
    log_file: "logs/tqworker_{path}_{date}.log" # Default: logs/tqworker_{path}_{date}.log

  # Per-path worker configuration overrides (optional)
  # Use this to apply different resource limits to specific routes
  paths:
    # Example: Limit resources for API endpoints
    "/api":
      go_max_procs: 2
      max_requests: 5000
      read_timeout_seconds: 15
      write_timeout_seconds: 15
      idle_timeout_seconds: 60
      go_mem_limit: "256MiB"
      request_timeout_seconds: 15
      idle_timeout_seconds: 60
      gomemlimit: "256MiB"
      log_file: "logs/api_{date}.log"

    # Example: Allow more resources for webhooks
    "/webhooks":
      go_max_procs: 1
      max_requests: 20000
      request_timeout_seconds: 120
      idle_timeout_seconds: 300
      go_mem_limit: "1GiB"
      log_file: "logs/webhooks_{date}.log"
